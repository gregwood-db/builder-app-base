bundle:
  name: builder-stack-app-sample

targets:
  dev:
    mode: development
    default: true
  staging:
    mode: production
  prod:
    mode: production
    workspace:
      root_path: /Workspace/Builder-Stack-Sample/${bundle.name}/${bundle.target}
    resources:
      apps:
        main_app:
          name: ${bundle.name}
      database_instances:
        app_db:
          name: ${bundle.name}

resources:
  database_instances:
    app_db:
      name: ${bundle.name}-${bundle.target}
      capacity: CU_1

  apps:
    main_app:
      name: ${bundle.name}-${bundle.target}
      description: "Builder Stack App Instance (${bundle.target})"
      source_code_path: .
      
      permissions:
        - level: CAN_USE
          group_name: users
      resources:
        - name: app_db_binding
          database:
            instance_name: ${resources.database_instances.app_db.name}
            database_name: databricks_postgres
            permission: CAN_CONNECT_AND_CREATE
